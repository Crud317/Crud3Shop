<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUDE SHOP | ABSOLUTE ARCHITECTURE v4.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Inter:wght@300;400;600;700;800;900&family=Space+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff0000;
            --primary-rgb: 255, 0, 0;
            --bg-deep: #030303;
            --card-surface: #0a0a0a;
            --text-main: #ffffff;
            --text-dim: #71717a;
            --accent-blue: #5865F2;
        }

        /* Base Setup */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none !important; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 20px; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            line-height: 1.5;
        }

        .brand-font { font-family: 'Syncopate', sans-serif; text-transform: uppercase; }
        .mono { font-family: 'Space Mono', monospace; }

        /* Background Graphics */
        #main-canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.6; pointer-events: none; }
        .vignette {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.8) 100%);
        }

        /* Glass Components */
        .glass {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .glass-hover:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 0, 0, 0.3);
        }

        /* Eye Logo Construction */
        .logo-wrapper { position: relative; width: 50px; height: 50px; }
        .eye-outer {
            width: 100%; height: 100%;
            border: 3px solid var(--primary);
            border-radius: 85% 15%;
            transform: rotate(45deg);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
            transition: 0.5s;
        }
        .eye-inner {
            width: 15px; height: 15px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 15px #fff;
            animation: eyeMove 5s infinite ease-in-out;
        }
        @keyframes eyeMove {
            0%, 100% { transform: translate(0,0) scale(1); }
            20% { transform: translate(5px, -5px) scale(0.9); }
            50% { transform: translate(-5px, 5px) scale(1.1); }
            80% { transform: translate(5px, 5px) scale(1); }
        }

        /* Card Mechanics */
        .product-card {
            background: var(--card-surface);
            border: 1px solid rgba(255,255,255,0.03);
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            position: relative;
        }
        .product-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 0 20px rgba(255,0,0,0.1);
        }
        .product-card img { filter: grayscale(100%) contrast(1.1); transition: 0.5s; }
        .product-card:hover img { filter: grayscale(0%) contrast(1); }

        /* Buttons */
        .btn-crude {
            position: relative;
            background: var(--primary);
            color: #fff;
            font-weight: 900;
            clip-path: polygon(8% 0, 100% 0, 92% 100%, 0% 100%);
            transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
            gap: 10px;
        }
        .btn-crude:hover {
            background: #fff; color: #000; transform: skewX(-2deg);
        }
        .btn-outline {
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.3s;
        }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }

        /* Utility */
        .modal-blur {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(12px); z-index: 5000;
            opacity: 0; pointer-events: none; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-active { opacity: 1; pointer-events: auto; }
        
        .toast {
            position: fixed; bottom: 20px; right: 20px; z-index: 9000;
            background: #111; border-left: 4px solid var(--primary);
            padding: 16px 24px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            transform: translateX(120%); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .toast-active { transform: translateX(0); }

        /* Views */
        .view-section { display: none; width: 100%; animation: fadeIn 0.6s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .view-visible { display: block; }

        /* Floating Cart Badge */
        .cart-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,0,0,0.4); } 70% { box-shadow: 0 0 0 10px rgba(255,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(255,0,0,0); } }
    </style>
</head>
<body>

<canvas id="main-canvas"></canvas>
<div class="vignette"></div>

<nav class="h-24 glass sticky top-0 z-[1000] px-6 lg:px-20 flex items-center justify-between border-b border-white/5">
    <div class="flex items-center gap-6 cursor-pointer group" onclick="switchView('home')">
        <div class="logo-wrapper">
            <div class="eye-outer"><div class="eye-inner"></div></div>
        </div>
        <div class="brand-font">
            <h1 class="text-2xl font-black tracking-tighter">CRUDE <span class="text-red-600 italic">SHOP</span></h1>
            <div class="flex items-center gap-2">
                <span class="w-8 h-[1px] bg-red-600"></span>
                <span class="text-[8px] tracking-[0.4em] text-zinc-500 uppercase">Est. 2026</span>
            </div>
        </div>
    </div>

    <div class="hidden xl:flex items-center gap-12">
        <nav-link onclick="switchView('home')" class="text-[10px] font-black uppercase tracking-widest cursor-pointer hover:text-red-600 transition">Terminal</nav-link>
        <nav-link onclick="switchView('shop')" class="text-[10px] font-black uppercase tracking-widest cursor-pointer hover:text-red-600 transition">Inventory</nav-link>
        <nav-link onclick="switchView('reviews')" class="text-[10px] font-black uppercase tracking-widest cursor-pointer hover:text-red-600 transition">Feedback</nav-link>
        <a href="https://discord.gg/crude" target="_blank" class="text-[10px] font-black uppercase tracking-widest text-accent-blue flex items-center gap-2">
            <i class="fa-brands fa-discord"></i> Discord Hub
        </a>
    </div>

    <div class="flex items-center gap-6">
        <div class="relative group hidden sm:block">
            <button class="glass px-4 py-2 rounded-lg text-[10px] font-black flex items-center gap-2">
                <span id="curr-display">USD ($)</span> <i class="fa-solid fa-chevron-down text-red-600"></i>
            </button>
            <div class="absolute right-0 top-full mt-2 w-40 glass rounded-xl hidden group-hover:block overflow-hidden shadow-2xl">
                <div onclick="updateCurrency('USD', 1, '$')" class="p-4 text-[10px] font-bold cursor-pointer hover:bg-red-600 transition">United States (USD)</div>
                <div onclick="updateCurrency('ARS', 1050, '$')" class="p-4 text-[10px] font-bold cursor-pointer hover:bg-red-600 transition">Argentina (ARS)</div>
                <div onclick="updateCurrency('EUR', 0.92, 'â‚¬')" class="p-4 text-[10px] font-bold cursor-pointer hover:bg-red-600 transition">Europe (EUR)</div>
            </div>
        </div>

        <div id="auth-zone">
            <button onclick="openModal('login-modal')" class="text-[10px] font-black uppercase border border-red-600/30 px-6 py-3 rounded-lg hover:bg-red-600 transition">Connect Roblox</button>
        </div>

        <div class="relative cursor-pointer group" onclick="toggleDrawer('cart-drawer')">
            <div class="w-12 h-12 glass flex items-center justify-center rounded-xl text-red-600 group-hover:bg-red-600 group-hover:text-white transition cart-indicator">
                <i class="fa-solid fa-briefcase"></i>
            </div>
            <span id="cart-count" class="absolute -top-2 -right-2 w-5 h-5 bg-white text-black text-[10px] font-black rounded flex items-center justify-center">0</span>
        </div>
    </div>
</nav>

<div id="toast-msg" class="toast">
    <div class="flex items-center gap-4">
        <i class="fa-solid fa-bolt text-red-600"></i>
        <span id="toast-text" class="text-[11px] font-black uppercase tracking-wider">System Alert</span>
    </div>
</div>

<main class="min-h-[calc(100vh-6rem)]">
    
    <section id="view-home" class="view-section view-visible">
        <div class="max-w-7xl mx-auto px-6 pt-32 pb-20 text-center">
            <div class="inline-flex items-center gap-3 bg-red-600/10 border border-red-600/20 px-4 py-2 rounded-full mb-8">
                <span class="w-2 h-2 rounded-full bg-red-600 animate-ping"></span>
                <span class="text-[10px] font-black uppercase tracking-widest text-red-500">Servers Operational</span>
            </div>
            <h1 class="text-7xl lg:text-[10rem] font-black italic tracking-tighter leading-none mb-8 brand-font">
                CRUDE <span class="text-red-600">CORE</span>
            </h1>
            <p class="max-w-2xl mx-auto text-zinc-500 text-lg mb-12 font-medium">
                Premier Roblox infrastructure & digital asset management. High-performance services for competitive players.
            </p>

            <div class="flex flex-wrap justify-center gap-6 mb-32">
                <button onclick="switchView('shop')" class="btn-crude px-10 py-5 text-sm w-full sm:w-64 uppercase">
                    Access Inventory <i class="fa-solid fa-terminal"></i>
                </button>
                <button class="btn-outline px-10 py-5 rounded-lg text-[10px] font-black uppercase w-full sm:w-64">
                    Documentation
                </button>
            </div>

            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 p-2 bg-white/5 rounded-[40px] border border-white/5 backdrop-blur-sm">
                <div class="p-12 text-center">
                    <h4 id="stat-sold" class="text-5xl font-black italic mb-2 tracking-tighter">0</h4>
                    <p class="text-[9px] text-zinc-500 font-black uppercase tracking-[0.3em]">Sold Assets</p>
                </div>
                <div class="p-12 text-center border-l border-white/5">
                    <h4 id="stat-customers" class="text-5xl font-black italic mb-2 tracking-tighter">0</h4>
                    <p class="text-[9px] text-zinc-500 font-black uppercase tracking-[0.3em]">Total Members</p>
                </div>
                <div class="p-12 text-center border-l border-white/5">
                    <h4 id="stat-reviews" class="text-5xl font-black italic mb-2 tracking-tighter">0</h4>
                    <p class="text-[9px] text-zinc-500 font-black uppercase tracking-[0.3em]">Verified Logs</p>
                </div>
                <div class="p-12 text-center border-l border-white/5">
                    <h4 id="stat-rating" class="text-5xl font-black italic mb-2 tracking-tighter text-red-600">0.0</h4>
                    <p class="text-[9px] text-zinc-500 font-black uppercase tracking-[0.3em]">Security Score</p>
                </div>
            </div>
        </div>
    </section>

    <section id="view-shop" class="view-section py-20 px-6">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col xl:flex-row justify-between items-end mb-16 gap-8">
                <div>
                    <h2 class="text-5xl font-black italic uppercase brand-font mb-2">System <span class="text-red-600">Stock</span></h2>
                    <p class="text-zinc-500 text-[10px] font-bold uppercase tracking-[0.4em]">Browse active repository</p>
                </div>
                <div class="flex flex-wrap gap-4 w-full xl:w-auto">
                    <div class="relative flex-1 min-w-[300px]">
                        <input type="text" id="search-input" oninput="filterProducts()" placeholder="Search data points..." class="w-full bg-white/5 border border-white/10 p-5 rounded-xl text-sm focus:border-red-600 outline-none transition">
                        <i class="fa-solid fa-search absolute right-5 top-1/2 -translate-y-1/2 text-zinc-600"></i>
                    </div>
                    <select id="cat-filter" onchange="filterProducts()" class="bg-white/5 border border-white/10 p-5 rounded-xl text-[10px] font-black uppercase outline-none focus:border-red-600">
                        <option value="all">All Categories</option>
                        <option value="items">Items</option>
                        <option value="accounts">Accounts</option>
                        <option value="services">Services</option>
                    </select>
                </div>
            </div>

            <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                </div>
        </div>
    </section>

    <section id="view-reviews" class="view-section py-20 px-6">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-4xl font-black italic brand-font mb-16 text-center">Transmission <span class="text-red-600">Logs</span></h2>
            <div id="reviews-container" class="grid gap-6">
                </div>
        </div>
    </section>

</main>

<div id="login-modal" class="modal-blur">
    <div class="bg-black border border-white/10 p-12 rounded-[40px] w-full max-w-md relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-red-600"></div>
        <h3 class="brand-font text-2xl mb-8 italic">Roblox <span class="text-red-600">Identity</span></h3>
        <form onsubmit="robAuth(event)" class="space-y-6">
            <div class="space-y-2">
                <label class="text-[10px] font-black text-zinc-500 uppercase tracking-widest">Roblox Username</label>
                <div class="relative">
                    <i class="fa-solid fa-user absolute left-5 top-1/2 -translate-y-1/2 text-red-600"></i>
                    <input type="text" id="rob-user" required placeholder="Builderman" class="w-full bg-white/5 border border-white/10 p-5 pl-14 rounded-2xl outline-none focus:border-red-600">
                </div>
            </div>
            <button type="submit" class="btn-crude w-full py-5">Initiate Connection</button>
        </form>
        <button onclick="closeModal('login-modal')" class="absolute top-8 right-8 text-zinc-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
    </div>
</div>

<div id="cart-drawer" class="fixed inset-y-0 right-0 w-full max-w-md bg-black border-l border-white/5 z-[7000] translate-x-full transition-transform duration-500 flex flex-col p-10">
    <div class="flex justify-between items-center mb-12">
        <h3 class="brand-font text-xl italic uppercase">Data Case</h3>
        <i class="fa-solid fa-chevron-right cursor-pointer p-4 hover:text-red-600" onclick="toggleDrawer('cart-drawer')"></i>
    </div>
    
    <div id="cart-items" class="flex-1 overflow-y-auto space-y-6 pr-4">
        </div>

    <div class="pt-8 border-t border-white/10 mt-6 space-y-6">
        <div class="flex items-center gap-4">
            <input type="text" id="coupon-input" placeholder="Coupon Code" class="flex-1 bg-white/5 border border-white/10 p-4 rounded-xl text-xs outline-none">
            <button onclick="applyCoupon()" class="bg-white/10 px-6 py-4 rounded-xl text-[10px] font-black uppercase hover:bg-red-600 transition">Apply</button>
        </div>
        <div class="flex justify-between items-end">
            <span class="text-zinc-500 font-black uppercase text-[10px]">Grand Total</span>
            <span id="final-price" class="text-4xl font-black text-red-600">$0.00</span>
        </div>
        <button onclick="checkoutFlow()" class="btn-crude w-full py-6 text-lg uppercase italic">Initialize Checkout</button>
    </div>
</div>

<div id="checkout-modal" class="modal-blur">
    <div class="bg-black border border-white/10 rounded-[50px] w-full max-w-5xl flex flex-col lg:flex-row overflow-hidden min-h-[600px]">
        <div class="lg:w-1/3 bg-[#080808] p-12 border-r border-white/5">
            <h4 class="brand-font text-sm mb-10 text-red-600">Order Digest</h4>
            <div id="digest-list" class="space-y-4 mb-10"></div>
            <div class="text-3xl font-black mono" id="digest-total">$0.00</div>
        </div>
        <div class="lg:w-2/3 p-12 flex flex-col justify-center">
            <h3 class="text-4xl font-black italic brand-font mb-4">Transmission <span class="text-red-600">Pending</span></h3>
            <p class="text-zinc-500 mb-12 text-sm">Review your data before committing to the blockchain.</p>
            
            <div class="grid gap-6 mb-12">
                <div class="glass p-6 rounded-2xl flex items-center justify-between">
                    <span class="text-[10px] font-black text-zinc-500 uppercase">Roblox Account</span>
                    <span id="checkout-user" class="font-black text-white">Guest</span>
                </div>
                <div class="glass p-6 rounded-2xl flex items-center justify-between">
                    <span class="text-[10px] font-black text-zinc-500 uppercase">Delivery Speed</span>
                    <span class="font-black text-green-500">INSTANTANEOUS</span>
                </div>
            </div>

            <button onclick="confirmPurchase()" class="btn-crude w-full py-6 text-xl">Confirm & Finalize</button>
        </div>
    </div>
</div>

<div id="rate-modal" class="modal-blur">
    <div class="bg-[#0a0a0a] border border-white/10 p-12 rounded-[40px] w-full max-w-md text-center">
        <h3 class="brand-font text-2xl mb-4 italic uppercase">Submit <span class="text-red-600">Log</span></h3>
        <p class="text-zinc-500 text-xs mb-10">Add your experience to our public database.</p>
        <div class="flex justify-center gap-4 mb-10 text-3xl">
            <i class="fa-solid fa-star star-sel cursor-pointer transition" onclick="setRating(1)"></i>
            <i class="fa-solid fa-star star-sel cursor-pointer transition" onclick="setRating(2)"></i>
            <i class="fa-solid fa-star star-sel cursor-pointer transition" onclick="setRating(3)"></i>
            <i class="fa-solid fa-star star-sel cursor-pointer transition" onclick="setRating(4)"></i>
            <i class="fa-solid fa-star star-sel cursor-pointer transition" onclick="setRating(5)"></i>
        </div>
        <textarea id="rate-text" placeholder="Protocol details..." class="w-full bg-white/5 border border-white/10 p-5 rounded-2xl mb-8 h-32 outline-none focus:border-red-600"></textarea>
        <button onclick="saveReview()" class="btn-crude w-full py-5">Post Review</button>
    </div>
</div>

<script>
    /* --- CONFIG & STATE --- */
    const DISCORD_WEBHOOK = "TU_WEBHOOK_AQUI"; // Inserte URL Real para habilitar

    const STORE_DB = {
        products: [
            { id: 1, cat: 'items', name: 'Slayer Fragments', price: 1.99, stock: 45, img: 'https://i.postimg.cc/q7fW3G8B/items-dh.png' },
            { id: 2, cat: 'items', name: 'Devil Heart', price: 3.50, stock: 12, img: 'https://i.postimg.cc/q7fW3G8B/items-dh.png' },
            { id: 3, cat: 'accounts', name: 'Starter Slayer LV.50', price: 5.99, stock: 8, img: 'https://i.postimg.cc/W3zD8z8Z/account-dh.png' },
            { id: 4, cat: 'accounts', name: 'Godly Account v2', price: 19.99, stock: 3, img: 'https://i.postimg.cc/W3zD8z8Z/account-dh.png' },
            { id: 5, cat: 'services', name: 'Rank Boost (1-100)', price: 9.99, stock: 99, img: 'https://i.postimg.cc/9F4P5p2h/farm-dh.png' },
            { id: 6, cat: 'services', name: 'Yen Farm 24h', price: 4.00, stock: 99, img: 'https://i.postimg.cc/9F4P5p2h/farm-dh.png' },
            { id: 7, cat: 'items', name: 'Ancient Scroll', price: 0.99, stock: 150, img: 'https://i.postimg.cc/q7fW3G8B/items-dh.png' },
            { id: 8, cat: 'accounts', name: 'Unverified Alt', price: 0.50, stock: 500, img: 'https://i.postimg.cc/W3zD8z8Z/account-dh.png' }
        ],
        reviews: [
            { user: 'RbxMaster', stars: 5, msg: 'Instant delivery on myFragments.', date: '2026-01-14' },
            { user: 'VoidWalker', stars: 4, msg: 'Good service, took 5 mins though.', date: '2026-01-10' }
        ]
    };

    let cart = [];
    let userSession = JSON.parse(localStorage.getItem('crude_session')) || null;
    let globalStats = JSON.parse(localStorage.getItem('crude_stats')) || { sold: 1420, members: 890, rating: 4.9, logs: 340 };
    let shopState = { rate: 1, symbol: '$', discount: 0 };
    let selectedRating = 0;

    /* --- INITIALIZATION --- */
    window.onload = () => {
        renderProducts();
        renderReviews();
        updateStatsUI();
        if(userSession) applySessionUI();
        animateHome();
        initCanvas();
    };

    /* --- DISCORD NOTIFIER --- */
    async function notifyDiscord(action, data) {
        if(!DISCORD_WEBHOOK.startsWith('https')) return;
        
        const payload = {
            embeds: [{
                title: `[SYSTEM LOG]: ${action}`,
                color: action === 'PURCHASE' ? 65280 : 16711680,
                fields: [
                    { name: 'User', value: userSession ? userSession.name : 'Guest', inline: true },
                    { name: 'Details', value: data, inline: false },
                    { name: 'Timestamp', value: new Date().toLocaleString(), inline: true }
                ],
                footer: { text: 'CRUDE SHOP ENGINE v4.0' }
            }]
        };

        fetch(DISCORD_WEBHOOK, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
    }

    /* --- NAVIGATION --- */
    function switchView(vid) {
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('view-visible'));
        document.getElementById(`view-${vid}`).classList.add('view-visible');
        window.scrollTo(0,0);
    }

    /* --- SHOP CORE --- */
    function renderProducts() {
        const grid = document.getElementById('product-grid');
        const search = document.getElementById('search-input').value.toLowerCase();
        const cat = document.getElementById('cat-filter').value;

        const filtered = STORE_DB.products.filter(p => {
            const matchesSearch = p.name.toLowerCase().includes(search);
            const matchesCat = cat === 'all' || p.cat === cat;
            return matchesSearch && matchesCat;
        });

        grid.innerHTML = filtered.map(p => {
            const price = (p.price * shopState.rate).toFixed(2);
            return `
                <div class="product-card p-6 rounded-[35px] group">
                    <div class="relative overflow-hidden rounded-2xl mb-6 aspect-video">
                        <img src="${p.img}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-red-600/10 opacity-0 group-hover:opacity-100 transition"></div>
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[8px] font-black uppercase text-red-600 tracking-[0.3em]">${p.cat}</span>
                        <span class="text-[8px] font-bold text-zinc-500">STOCK: ${p.stock}</span>
                    </div>
                    <h3 class="text-lg font-black italic uppercase mb-6 truncate">${p.name}</h3>
                    <div class="flex items-center gap-4">
                        <div class="flex-1 bg-white/5 p-4 rounded-xl border border-white/5">
                            <span class="text-xl font-black">${shopState.symbol}${price}</span>
                        </div>
                        <button onclick="addToCart(${p.id})" class="w-14 h-14 bg-red-600 rounded-xl flex items-center justify-center hover:bg-white hover:text-black transition">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                    <button onclick="instantBuy(${p.id})" class="w-full mt-4 text-[9px] font-black uppercase tracking-widest text-zinc-500 hover:text-white transition">Instant Purchase</button>
                </div>
            `;
        }).join('');
    }

    function filterProducts() { renderProducts(); }

    /* --- CART SYSTEM --- */
    function addToCart(id) {
        const prod = STORE_DB.products.find(x => x.id === id);
        if(prod.stock <= 0) return callToast("OUT OF STOCK");
        
        cart.push({...prod, cartId: Date.now()});
        updateCartUI();
        callToast(`ENCRYPTED: ${prod.name}`);
        notifyDiscord("CART ADD", `Added ${prod.name} to cart.`);
    }

    function instantBuy(id) {
        cart = [];
        addToCart(id);
        toggleDrawer('cart-drawer');
    }

    function removeFromCart(cid) {
        cart = cart.filter(x => x.cartId !== cid);
        updateCartUI();
    }

    function updateCartUI() {
        document.getElementById('cart-count').innerText = cart.length;
        const list = document.getElementById('cart-items');
        let total = 0;

        if(cart.length === 0) {
            list.innerHTML = `<div class="h-full flex flex-col items-center justify-center opacity-20">
                <i class="fa-solid fa-folder-open text-6xl mb-4"></i>
                <p class="text-[10px] font-black uppercase">Cache Empty</p>
            </div>`;
        } else {
            list.innerHTML = cart.map(i => {
                const p = (i.price * shopState.rate);
                total += p;
                return `
                    <div class="flex items-center gap-4 glass p-4 rounded-2xl border-white/5">
                        <img src="${i.img}" class="w-12 h-12 rounded-lg grayscale">
                        <div class="flex-1">
                            <h4 class="text-[10px] font-black uppercase truncate w-32">${i.name}</h4>
                            <p class="text-red-600 font-black">${shopState.symbol}${p.toFixed(2)}</p>
                        </div>
                        <i onclick="removeFromCart(${i.cartId})" class="fa-solid fa-circle-xmark text-zinc-600 hover:text-red-600 cursor-pointer"></i>
                    </div>
                `;
            }).join('');
        }

        const discounted = total * (1 - shopState.discount);
        document.getElementById('final-price').innerText = `${shopState.symbol}${discounted.toFixed(2)}`;
        
        // Checkout Data
        document.getElementById('digest-total').innerText = `${shopState.symbol}${discounted.toFixed(2)}`;
        document.getElementById('digest-list').innerHTML = cart.map(i => `
            <div class="flex justify-between text-[10px] font-bold text-zinc-500 uppercase">
                <span>${i.name}</span>
                <span>${shopState.symbol}${(i.price * shopState.rate).toFixed(2)}</span>
            </div>
        `).join('');
    }

    function applyCoupon() {
        const val = document.getElementById('coupon-input').value.toUpperCase();
        if(val === 'CRUDE20') {
            shopState.discount = 0.20;
            callToast("DISCOUNT APPLIED: 20%");
            updateCartUI();
        } else {
            callToast("INVALID CIPHER");
        }
    }

    /* --- AUTH & SESSION --- */
    function robAuth(e) {
        e.preventDefault();
        const user = document.getElementById('rob-user').value;
        if(user.length < 3) return callToast("USER TOO SHORT");

        userSession = { name: user, joined: new Date().toLocaleDateString() };
        localStorage.setItem('crude_session', JSON.stringify(userSession));
        
        notifyDiscord("AUTH LOGIN", `Roblox User **${user}** connected.`);
        applySessionUI();
        closeModal('login-modal');
        callToast(`LINKED: ${user}`);
    }

    function applySessionUI() {
        const zone = document.getElementById('auth-zone');
        zone.innerHTML = `
            <div class="flex items-center gap-4 bg-red-600/5 border border-red-600/20 px-5 py-2 rounded-xl">
                <div class="text-right">
                    <p class="text-[10px] font-black uppercase leading-none text-red-600">${userSession.name}</p>
                    <p onclick="logout()" class="text-[8px] font-bold text-zinc-600 hover:text-white cursor-pointer uppercase tracking-tighter">Disconnect</p>
                </div>
                <i class="fa-solid fa-shield-halved text-red-600"></i>
            </div>
        `;
        document.getElementById('checkout-user').innerText = userSession.name;
    }

    function logout() {
        localStorage.removeItem('crude_session');
        location.reload();
    }

    /* --- CHECKOUT FLOW --- */
    function checkoutFlow() {
        if(!userSession) return openModal('login-modal');
        if(cart.length === 0) return callToast("EMPTY CASE");
        openModal('checkout-modal');
    }

    function confirmPurchase() {
        const items = cart.map(x => x.name).join(', ');
        const total = document.getElementById('digest-total').innerText;
        
        notifyDiscord("PURCHASE", `User **${userSession.name}** bought: ${items}. Total: ${total}`);
        
        // Update Stats
        globalStats.sold += cart.length;
        globalStats.members += 1;
        saveStats();

        cart = [];
        updateCartUI();
        closeModal('checkout-modal');
        toggleDrawer('cart-drawer');
        
        setTimeout(() => openModal('rate-modal'), 800);
        callToast("TRANSACTION SUCCESS");
    }

    /* --- REVIEW SYSTEM --- */
    function setRating(n) {
        selectedRating = n;
        document.querySelectorAll('.star-sel').forEach((s, i) => {
            s.style.color = i < n ? '#ff0000' : '#27272a';
        });
    }

    function saveReview() {
        if(selectedRating === 0) return callToast("SELECT RATING");
        const msg = document.getElementById('rate-text').value || "Default Protocol";
        
        const rev = {
            user: userSession.name,
            stars: selectedRating,
            msg: msg,
            date: new Date().toISOString().split('T')[0]
        };

        STORE_DB.reviews.unshift(rev);
        globalStats.logs += 1;
        saveStats();
        renderReviews();
        closeModal('rate-modal');
        callToast("LOG SAVED");
    }

    function renderReviews() {
        const container = document.getElementById('reviews-container');
        container.innerHTML = STORE_DB.reviews.map(r => `
            <div class="glass p-8 rounded-[30px] border-white/5 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-6 flex gap-1 text-[8px] text-red-600">
                    ${Array(r.stars).fill('<i class="fa-solid fa-star"></i>').join('')}
                </div>
                <h4 class="text-[10px] font-black uppercase text-red-600 mb-2">${r.user}</h4>
                <p class="text-sm text-zinc-400 italic">"${r.msg}"</p>
                <div class="mt-6 flex items-center justify-between">
                    <span class="text-[8px] font-bold text-zinc-600 mono">${r.date}</span>
                    <span class="text-[8px] font-black uppercase tracking-widest text-zinc-500">Verified Transfer</span>
                </div>
            </div>
        `).join('');
    }

    /* --- INTERFACE UTILS --- */
    function openModal(id) { document.getElementById(id).classList.add('modal-active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('modal-active'); }
    function toggleDrawer(id) {
        const d = document.getElementById(id);
        const isOpen = d.style.transform === 'translateX(0%)';
        d.style.transform = isOpen ? 'translateX(100%)' : 'translateX(0%)';
    }

    function callToast(txt) {
        const t = document.getElementById('toast-msg');
        document.getElementById('toast-text').innerText = txt;
        t.classList.add('toast-active');
        setTimeout(() => t.classList.remove('toast-active'), 3000);
    }

    function updateCurrency(curr, rate, sym) {
        shopState.rate = rate;
        shopState.symbol = sym;
        document.getElementById('curr-display').innerText = `${curr} (${sym})`;
        renderProducts();
        updateCartUI();
        callToast(`CURRENCY: ${curr}`);
    }

    function updateStatsUI() {
        document.getElementById('stat-sold').innerText = globalStats.sold;
        document.getElementById('stat-customers').innerText = globalStats.members;
        document.getElementById('stat-reviews').innerText = globalStats.logs;
        document.getElementById('stat-rating').innerText = globalStats.rating.toFixed(1);
    }

    function saveStats() {
        localStorage.setItem('crude_stats', JSON.stringify(globalStats));
        updateStatsUI();
    }

    /* --- VISUAL EFFECTS --- */
    function animateHome() {
        // Counter Animation
        const counters = ['stat-sold', 'stat-customers', 'stat-reviews'];
        counters.forEach(c => {
            const el = document.getElementById(c);
            const target = parseInt(el.innerText);
            let count = 0;
            const inc = target / 50;
            const timer = setInterval(() => {
                count += inc;
                if(count >= target) { el.innerText = target; clearInterval(timer); }
                else { el.innerText = Math.floor(count); }
            }, 30);
        });
    }

    function initCanvas() {
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        let points = [];
        
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();

        for(let i=0; i<60; i++) {
            points.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 0.4,
                vy: (Math.random() - 0.5) * 0.4
            });
        }

        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.strokeStyle = "rgba(255, 0, 0, 0.15)";
            points.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
                
                points.forEach(p2 => {
                    const d = Math.hypot(p.x - p2.x, p.y - p2.y);
                    if(d < 180) {
                        ctx.lineWidth = 1 - (d/180);
                        ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                    }
                });
            });
            requestAnimationFrame(draw);
        }
        draw();
    }

</script>
</body>
</html>
